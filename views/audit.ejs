<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Audit Trail - Permit <%= permitId %></title>
  <link rel="stylesheet" href="/css/style.css" />
</head>
<body>
  <main class="container">
    <header class="page-header row space-between wrap gap-md">
      <div>
        <h1>Audit Trail: Permit #<%= permitId %></h1>
      </div>
      <a class="button ghost" href="/permits">‚Üê Back to permits</a>
    </header>

    <section class="card">
      <% if (!auditRows.length) { %>
        <p class="muted">No audit records found.</p>
      <% } %>

      <div class="audit-list">
        <% auditRows.forEach(r => { %>
          <article class="audit-item">
            <div class="row space-between wrap gap">
              <div class="row gap wrap">
                <span class="status-pill status-<%= r.action %>"><%= r.actionLabel %></span>
                <strong><%= r.username %></strong>
              </div>
              <span class="muted"><%= r.changedAtPretty %></span>
            </div>

            <% if (r.changes && r.changes.length) { %>
              <div class="table-wrap" style="margin-top:10px;">
                <table class="audit-change-table">
                  <thead>
                    <tr><th>Field</th><th>Before</th><th>After</th></tr>
                  </thead>
                  <tbody>
                    <% r.changes.forEach(c => { %>
                      <tr>
                        <td><strong><%= c.label %></strong></td>
                        <td><%= c.oldValue %></td>
                        <td><%= c.newValue %></td>
                      </tr>
                    <% }) %>
                  </tbody>
                </table>
              </div>
            <% } else { %>
              <p class="muted" style="margin-top:10px;">No field-level differences available for this entry.</p>
            <% } %>
          </article>
        <% }) %>
      </div>
    </section>
  </main>
</body>
</html>
